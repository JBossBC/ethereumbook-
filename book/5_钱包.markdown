# 钱包

“钱包”一词用于描述以太坊中的一些不同事物。

在高层次上，钱包是一种软件应用程序，作为以太坊的主要用户界面。钱包控制对用户资金的访问、管理密钥和地址、跟踪余额以及创建和签署交易。此外，一些以太坊钱包也可以与合约进行交互，例如ERC20代币。

更狭义地说，从程序员的角度来看，钱包一词是指用于存储和管理用户密钥的系统。每个钱包都有一个密钥管理组件。对于某些钱包，仅此而已。其他钱包属于更广泛类别的一部分，即浏览器，它们是基于以太坊的去中心化应用程序或 DApp 的接口，我们将在 [去中心化应用程序章节] 中更详细地研究它们。在术语钱包下合并的各种类别之间没有明确的区别。

在本章中，我们将钱包视为私钥的容器，以及管理这些私钥的系统。


## 钱包技术概述


在本节中，我们总结了用于构建用户友好、安全和灵活的以太坊钱包的各种技术。

设计钱包的一个关键考虑因素是平衡便利性和隐私性。最方便的以太坊钱包是一个只有一个私钥和地址的钱包，您可以重复使用它来处理所有事情。不幸的是，这样的解决方案是一场隐私噩梦，因为任何人都可以轻松跟踪和关联您的所有交易。为每笔交易使用新密钥最有利于保护隐私，但变得非常难以管理。很难达到正确的平衡，但这就是为什么好的钱包设计至关重要。

关于以太坊的一个常见误解是以太坊钱包包含以太币或代币。事实上，非常严格地说，**钱包只装钥匙。以太币或其他代币记录在以太坊区块链上。**用户通过使用钱包中的密钥签署交易来控制网络上的代币。从某种意义上说，以太坊钱包是一个钥匙串。话虽如此，鉴于钱包持有的密钥是将以太币或代币转移给他人所需的唯一东西，实际上这种区别是无关紧要的。真正重要的区别在于改变处理传统银行中心化系统的思维方式（只有你和银行才能看到你账户中的钱，你只需要说服银行你想将资金转移到进行交易）到区块链平台的去中心化系统（每个人都可以看到账户的以太币余额，尽管他们可能不知道账户的所有者，并且每个人都需要确信所有者想要将资金转移到颁布）。在实践中，这意味着有一种独立的方式来检查账户的余额，而不需要它的钱包。此外，如果您开始不喜欢开始使用的钱包应用程序，您可以将您的帐户处理从当前钱包转移到另一个钱包。


> 注意:以太坊钱包包含密钥，而不是以太币或代币。钱包就像包含一对私钥和公钥的钥匙串。用户使用私钥签署交易，从而证明他们拥有以太币。ether存储在区块链上。


有两种主要类型的钱包，根据它们包含的密钥是否相互关联来区分。

第一种是非确定性钱包，其中每个密钥都是从不同的随机数独立生成的。键彼此不相关。这种类型的钱包也被称为 JBOK 钱包，来自短语“Just a Bunch of Keys”。

第二种类型的钱包是确定性钱包，其中所有密钥都来自一个主密钥，称为种子。这类钱包中的所有密钥都是相互关联的，如果有原始种子，可以重新生成。确定性钱包中使用了许多不同的密钥派生方法。最常用的推导方法使用树状结构，如分层确定性钱包 (BIP-32/BIP-44) 中所述。

为了使确定性钱包稍微更安全地防止数据丢失事故，例如手机被盗或掉进马桶，种子通常被编码为单词列表（英语或其他语言）供您写下和使用万一发生事故。这些被称为钱包的助记码字。当然，如果有人拿到了你的助记词，那么他们也可以重新创建你的钱包，从而获得你的以太币和智能合约。因此，要非常非常小心你的恢复词列表！切勿将其以电子方式存储在文件中、计算机或手机上。将其写在纸上并将其存放在安全可靠的地方。

接下来的几节将在较高层次上介绍这些技术中的每一项。


## 非确定性（随机）钱包

在第一个以太坊钱包（为以太坊预售而制作）中，每个钱包文件都存储了一个随机生成的私钥。此类钱包正在被确定性钱包取代，因为这些“老式”钱包在很多方面都不如人意。例如，在使用以太坊时，避免重复使用以太坊地址作为最大化隐私的一部分被认为是一种很好的做法——即，每次收到资金时使用一个新地址（需要一个新的私钥）。你可以更进一步，为每笔交易使用一个新地址，尽管如果你处理大量代币，这可能会变得昂贵。为了遵循这种做法，非确定性钱包将需要定期增加其密钥列表，这意味着您将需要进行定期备份。如果您在成功备份钱包之前丢失了数据（磁盘故障、酒后事故、手机被盗），您将无法访问您的资金和智能合约。 “0 型”非确定性钱包是最难处理的，因为它们以“及时”的方式为每个新地址创建一个新的钱包文件。

然而，许多以太坊客户端（包括 geth）使用密钥库文件，这是一个 JSON 编码的文件，包含一个（随机生成的）私钥，并通过密码加密以提高安全性。 JSON 文件的内容如下所示：

    {
    "address": "001d3f1ef827552ae1114027bd3ecf1f086ba0f9",
    "crypto": {
        "cipher": "aes-128-ctr",
        "ciphertext":
            "233a9f4d236ed0c13394b504b6da5df02587c8bf1ad8946f6f2b58f055507ece",
        "cipherparams": {
            "iv": "d10c6ec5bae81b6cb9144de81037fa15"
        },
        "kdf": "scrypt",
        "kdfparams": {
            "dklen": 32,
            "n": 262144,
            "p": 1,
            "r": 8,
            "salt":
                "99d37a47c7c9429c66976f643f386a61b78b97f3246adca89abe4245d2788407"
        },
        "mac": "594c8df1c8ee0ded8255a50caf07e8c12061fd859f4b7c76ab704b17c957e842"
    },
    "id": "4fcb2ba4-ccdb-424f-89d5-26cce304bf9c",
    "version": 3
    }

密钥库格式使用密钥派生函数 (KDF)，也称为密码拉伸算法，可防止暴力攻击、字典攻击和彩虹表攻击。简单来说，私钥不是直接用passphrase加密的。取而代之的是，通过反复散列来扩展密码。哈希函数重复 262,144 轮，这可以在密钥库 JSON 中作为参数 crypto.kdfparams.n 看到。试图暴力破解密码短语的攻击者必须对每个尝试的密码短语应用 262,144 轮散列，这会充分减慢攻击速度，使其无法用于具有足够复杂性和长度的密码短语。

> 除了简单测试之外，不鼓励使用非确定性钱包。除了最基本的情况外，它们太笨重而无法备份和使用。相反，使用基于行业标准的 HD 钱包和助记词种子进行备份。


## 确定性（种子）钱包


确定性或“种子”钱包是包含私钥的钱包，这些私钥均源自单个主密钥或种子。种子是一个随机生成的数字，它与其他数据相结合，例如索引号或“链码”（请参阅​​扩展公钥和私钥），以派生出任意数量的私钥。在确定性钱包中，种子足以恢复所有派生密钥，因此在创建时的单个备份足以保护钱包中的所有资金和智能合约。种子也足以用于钱包导出或导入，允许在不同钱包实现之间轻松迁移所有密钥。

这种设计使种子的安全性变得至关重要，因为只需要种子就可以访问整个钱包。另一方面，能够将安全工作集中在单个数据上可以被视为一种优势。


### 分层确定性钱包 (BIP-32/BIP-44)


开发确定性钱包是为了方便从单个种子中导出许多密钥。目前，最先进的确定性钱包形式是比特币 BIP-32 标准定义的分层确定性 (HD) 钱包。 HD 钱包包含以树结构派生的密钥，这样父密钥可以派生出一系列子密钥，每个子密钥都可以派生出一系列孙密钥，依此类推。这种树结构在 HD 钱包中有说明：从单个种子生成的密钥树。

### 种子和助记码（BIP-39）


有许多方法可以对私钥进行编码以实现安全备份和检索。目前首选的方法是使用一系列单词，当这些单词以正确的顺序组合在一起时，可以唯一地重新创建私钥。这有时被称为助记符，并且该方法已由 BIP-39 标准化。今天，许多以太坊钱包（以及其他加密货币的钱包）都使用这个标准，并且可以使用可互操作的助记符导入和导出种子以进行备份和恢复。

要了解为什么这种方法变得流行，让我们看一个例子：

确定性钱包的种子，十六进制

> FCCF1AB3329FD5DA3DA9577511F8F137

一个确定性钱包的种子，来自一个12字的助记词

> wolf juice proud gown wool unfair
> 
>wall cliff insect more detail hub


实际上，写下十六进制序列时出错的可能性高得令人无法接受。相比之下，known words列表就相当好处理了，主要是因为单词（尤其是英文单词）的书写冗余度很高。如果不小心记录了“inzect”，则可以根据钱包恢复的需要快速确定“inzect”不是有效的英文单词，应该使用“insect”代替。我们正在谈论写下种子的表示，因为这是管理 HD 钱包的好习惯：在数据丢失（无论是由于意外还是被盗）的情况下，需要种子来恢复钱包，因此保留备份是非常谨慎的.但是，种子必须非常保密，因此应小心避免数字备份；因此，较早的建议是用笔和纸进行备份。

综上所述，使用恢复词列表对HD钱包种子进行编码，是安全导出、转录、记录在纸上、无误读取以及将私钥集导入另一个钱包的最简单方法。


## 钱包最佳实践


随着加密货币钱包技术的成熟，出现了某些通用的行业标准，使钱包具有广泛的互操作性、易于使用、安全和灵活。这些标准还允许钱包从单个助记符中导出多种不同加密货币的密钥。这些通用标准是：


+ 助记词，基于BIP-39
+ HD钱包，基于BIP-32
+ 多用途HD钱包结构，基于BIP-43
+ 基于 BIP-44 的多币种和多账户钱包

这些标准可能会随着未来的发展而改变或被淘汰，但目前它们形成了一套相互关联的技术，这些技术已成为大多数区块链平台及其加密货币的事实上的钱包标准。

这些标准已被广泛的软件和硬件钱包采用，使所有这些钱包都可以互操作。用户可以导出在其中一个钱包中生成的助记词，并将其导入到另一个钱包中，从而恢复所有密钥和地址。

支持这些标准的一些软件钱包示例包括（按字母顺序列出）Jaxx、MetaMask、MyCrypto 和 MyEtherWallet (MEW)。支持这些标准的硬件钱包示例包括 Keepkey、Ledger 和 Trezor。

以下各节将详细研究这些技术中的每一项。

> 提示:如果你正在使用以太坊钱包，则应该将其构建为HD钱包，种子编码为助记词提供备份，遵循BIP-32、BIP-39、BIP43、和BIP44标准，如所述在以下部分。

### 助记词(BIP-39)

助记词是对随机数进行编码的单词序列，该随机数用作派生确定性钱包的种子。单词序列足以重新创建种子，并从那里重新创建钱包和所有派生密钥。使用助记词实现确定性钱包的钱包应用程序将在首次创建钱包时向用户显示 12 到 24 个单词的序列。该单词序列是钱包备份，可用于恢复和重新创建相同或任何兼容钱包应用程序中的所有密钥。正如我们之前解释的那样，助记词列表使用户更容易备份钱包，因为它们易于阅读和正确转录。

> 注意:助记词经常与“brainwallets”混淆。他们不一样。主要区别在于脑钱包由用户选择的单词组成，而助记词是由钱包随机创建并呈现给用户的。这个重要的区别使得助记词更加安全，因为人类是非常差的随机性来源。或许更重要的是，使用“brainwallets”一词意味着必须记住这些单词，这是一个糟糕的想法，也是在需要时没有备份的秘诀。


助词在 BIP-39 中定义。请注意，BIP-39 是助记词标准的一种实现。 Electrum 比特币钱包使用不同的标准，使用不同的词组，早于 BIP-39。 BIP-39 是由 Trezor 硬件钱包背后的公司提出的，与 Electrum 的实施不兼容。然而，BIP-39 现在已经在数十个可互操作的实现中获得了广泛的行业支持，应该被视为事实上的行业标准。此外，BIP-39 可用于生产支持以太坊的多币种钱包，而 Electrum 种子则不能。


BIP-39 定义了助记词和种子的创建，我们在这里分九个步骤进行描述。为清楚起见，该过程分为两部分：步骤 1 到 6 显示在生成助记词中，步骤 7 到 9 显示在从助记符到种子中。


### 生成助记词

助记词由钱包使用 BIP-39 中定义的标准化流程自动生成。钱包从熵源开始，添加校验和，然后将熵映射到单词列表：


+ 创建 128 到 256 位的加密随机序列 S。
+ 通过取 S 的第一个长度 ÷ S 的 SHA-256 散列的 32 位来创建 S 的校验和。
+ 将校验和添加到随机序列 S 的末尾。
+ 将序列和校验和串联分成 11 位的部分。
+ 将每个 11 位值映射到包含 2,048 个单词的预定义字典中的一个单词。
+ 从单词序列创建助记码，保持顺序。


生成熵和编码为助记词展示了如何使用熵来生成助记词。

助记词：熵与词长表示熵数据的大小与词中助记码长度的关系。

表1.助记词：熵和字长

|熵|校验和|熵+校验和|助记词长度|
|--|--|--|--|
|128|4|132|12|
|160|5|165|15|
|192|6|198|18|
|224|7|231|21|

![图2](https://github.com/JBossBC/ethereumbook-ch/blob/main/book/images/bip39-part1.png?raw=true)

图2.生成熵并编码为助记词

### 从助记词到种子

助记词表示熵，长度为128位到256位，然后，通过使用密钥扩展函数PBKDF2,使用熵来导出更长的512位种子，产生的种子用于构建确定性钱包并派生其密钥。

密钥扩展有两个参数:助记词和salt。密钥扩展函数中加盐的目的是使构建支持暴力攻击的查找表变得困难。在BIP-39标准中，salt还有另一个目的:它允许引入一个密码短语，作为保护种子的额外安全因素，我们将在BIP-39中的可选密码短语中更详细地描述

步骤7到9中描述的过程从上一节中描述的过程继续:

+ PBKDF2密钥拉伸函数的第一个参数是在步骤6中生成助记词。
+ PBKDF2密钥扩展函数的第二个参数是salt。salt由字符串常量"mnemonic"和可选的用户提供的密码组成。
+ PBKDF2使用HMAC-SHA512算法使用2048轮散列来扩展助记词和salt参数，产生512位值作为其最终输出。这个512位的值就是种子。


从助记词到种子展示了如何使用助记符生成种子。


！[图3](https://github.com/JBossBC/ethereumbook-ch/blob/main/book/images/bip39-part2.png?raw=true)

图3.从助记词到种子

> 注意： 具有2048轮散列的密钥扩展功能在某种程度上可以有效地防止针对助记词或密码的暴力攻击。尝试超过几千个密码短语和助记词组合的成本很高(在计算中)，而可能派生的种子数量很大(2^512,或大约10^154）--远远大于可见宇宙中的原子数量(大约10^80)


下表显示了助记词及其产生的种子的一些示例。

表2.128 位熵助记码，无密码，生成的种子

|熵输入(128位)|0c1e24e5917779d297e14d45f14e1a1a|
|--|--|
|助记词(12个词)|a rmy van defense carry jealous true garbage claim echo media make crunch|
|短语|(none)|
|种子(512位)|5b56c417303faa3fcba7e57400e120a0ca83ec5a4fc9ffba757fbe63fbd77a89a1a3be4c67196f57c39 a88b76373733891bfaba16ed27a813ceed498804c0570|


### BIP39中的可选密码


BIP-39 标准允许在推导种子时使用可选的密码短语。如果不使用密码短语，则助记符将使用由常量字符串“助记符”组成的盐来拉伸，从任何给定的助记符生成特定的 512 位种子。如果使用密码短语，则拉伸函数会根据相同的助记符生成不同的种子。事实上，给定一个助记符，每个可能的密码短语都会导致不同的种子。本质上，没有“错误”的密码。所有密码短语都是有效的，它们都会导致不同的种子，形成大量可能的未初始化钱包。可能的钱包集非常大 (2512)，只要密码短语具有足够的复杂性和长度，就没有暴力破解或意外猜测正在使用的钱包的实际可能性。



> 注意:BIP-39 中没有“错误”的密码短语。每个密码短语都会指向某个钱包，除非之前使用过，否则该钱包将是空的。


可选密码创建了两个重要功能：

+ 使助记符本身无用的第二个因素（记住的东西）保护助记符备份免受小偷的破坏。
+ 一种似是而非的否认或“胁迫钱包”形式，其中选择的密码短语导致钱包中有少量资金，用于分散攻击者对包含大部分资金的“真实”钱包的注意力。

然而，重要的是要注意使用密码短语也会带来丢失的风险：

+ 如果钱包所有者丧失行为能力或死亡，而没有其他人知道密码，则种子将毫无用处，钱包中存储的所有资金将永远丢失。
+ 相反，如果所有者在与种子相同的位置备份密码短语，则会破坏第二个因素的目的。

虽然密码短语非常有用，但考虑到所有者幸存的继承人能够恢复加密货币的可能性，它们只能与精心计划的备份和恢复过程结合使用。

### 使用助记词


BIP-39 被实现为许多不同编程语言的库。例如：

+ python-mnemonic

提出 BIP-39 的 SatoshiLabs 团队在 Python 中对标准的参考实现

+ ConsenSys/eth-lightwallet

用于节点和浏览器的轻量级 JS 以太坊钱包（使用 BIP-39）

+ npm/bip39

比特币BIP-39的JavaScript实现：生成确定性密钥的助记词


还有一个 BIP-39 generator implemented in a standalone web page（A BIP-39 generator as a standalone web page），这对于测试和实验非常有用。助记词代码转换器生成助记词、种子和扩展私钥。它可以在浏览器中离线使用，也可以在线访问。


！[图4](https://github.com/JBossBC/ethereumbook-ch/blob/main/book/images/bip39_web.png?raw=true)

图4.作为独立网页的BIP39生成器

## 从种子创建HD钱包


HD 钱包是从单个根种子创建的，它是一个 128、256 或 512 位的随机数。最常见的是，这个种子是从上一节中详述的助记符生成的。


HD 钱包中的每个密钥都确定地源自这个根种子，这使得可以在任何兼容的 HD 钱包中从该种子重新创建整个 HD 钱包。这使得导出、备份、恢复和导入包含数千甚至数百万个密钥的 HD 钱包变得容易，只需传输从中导出根种子的助记词。

## HD钱包(BIP-32)和路径(BIP-43/44)

大多数 HD 钱包遵循 BIP-32 标准，该标准已成为确定性密钥生成的事实上的行业标准。


我们不会在这里讨论 BIP-32 的所有细节，只讨论了解它如何在钱包中使用的必要组件。

主要的重要方面是派生密钥可能具有的树状层次关系，正如您在 HD 钱包中看到的那样：从单个种子生成的密钥树。了解扩展密钥和强化密钥的概念也很重要，这些将在以下部分中进行解释。

许多软件库中提供了数十种可互操作的 BIP-32 实现。这些主要是为比特币钱包设计的，它们以不同的方式实现地址，但与以太坊的 BIP-32 兼容钱包共享相同的密钥派生实现。使用专为以太坊设计的，或通过添加以太坊地址编码库从比特币改编。


还有一个作为独立网页实现的 BIP-32 生成器，对于使用 BIP-32 进行测试和实验非常有用。




> 注意:独立的 BIP-32 生成器不是 HTTPS 站点。这是为了提醒您使用此工具并不安全。它仅用于测试。您不应使用真实资金使用本网站生成的密钥。


## 扩展公钥和私钥


在 BIP-32 术语中，密钥可以“扩展”。通过正确的数学运算，这些扩展的“父”键可用于派生“子”键，从而产生前面描述的键和地址的层次结构。父键不必位于树的顶部。它可以从树层次结构中的任何地方挑选出来。扩展密钥涉及获取密钥本身并向其附加特殊的链码。链码是一个 256 位二进制字符串，它与每个密钥混合以生成子密钥。


如果密钥是私钥，则成为扩展私钥，以前缀 xprv 区分：

> xprv9s21ZrQH143K2JF8RafpqtKiTbsbaxEeUaMnNHsm5o6wCW3z8ySyH4UxFVSfZ8n7ESu7fgir8i...

扩展公钥由前缀 xpub 区分：

> xpub661MyMwAqRbcEnKbXcCqD2GT1di5zQxVqoHPAgHNe8dv5JP8gWmDproS6kFHJnLZd23tWevhdn...

HD 钱包的一个非常有用的特性是能够从父公钥导出子公钥，而无需私钥。
**这为我们提供了两种导出子公钥的方法：直接从子私钥或从父公钥导出。** 


因此，可以使用扩展公钥来导出 HD 钱包结构的该分支中的所有公钥（并且仅是公钥）。


此快捷方式可用于创建非常安全的仅公钥部署，其中服务器或应用程序具有扩展公钥的副本，但没有任何私钥。这种部署可以产生无限数量的公钥和以太坊地址，但不能花费发送到这些地址的任何资金。同时，在另一台更安全的服务器上，扩展的私钥可以派生出所有对应的私钥来签署交易和花钱。



此方法的一个常见应用是在为电子商务应用程序提供服务的 Web 服务器上安装扩展公钥。Web 服务器可以使用公钥派生功能为每笔交易（例如，为客户购物车）创建一个新的以太坊地址，并且不会有任何容易被盗的私钥。如果没有 HD 钱包，唯一的方法是在单独的安全服务器上生成数千个以太坊地址，然后将它们预加载到电子商务服务器上。这种方法很麻烦，需要不断维护以确保服务器不会用完密钥，因此首选使用来自 HD 钱包的扩展公钥。


该解决方案的另一个常见应用是冷存储或硬件钱包。在这种情况下，扩展私钥可以存储在硬件钱包中，而扩展公钥可以在线保存。用户可以随意创建“接收”地址，而私钥安全地离线存储。要花费资金，用户可以在离线签名以太坊客户端中使用扩展私钥，或在硬件钱包设备上签署交易。

## 强化子密钥派生

从扩展公钥或 xpub 派生公钥分支的能力非常有用，但它也有潜在的风险。访问 xpub 并不能访问子私钥。然而，因为 xpub 包含链码（用于从父公钥派生子公钥），如果子私钥已知或以某种方式泄露，它可以与链码一起使用来派生所有其他子私钥键。单个泄露的子私钥与父链码一起揭示了所有子节点的所有私钥。更糟糕的是，子私钥与父链码一起可以用来推导出父私钥。


为了应对这种风险，HD 钱包使用了一种称为硬化推导的替代推导函数，它“打破”了父公钥和子链代码之间的关系。硬化派生函数使用父私钥来派生子链码，而不是父公钥。这在父/子序列中创建了一个“防火墙”，其链码不能用于破坏父或兄弟私钥。


简单来说，如果您想利用 xpub 的便利性来派生公钥的分支，而又不想让自己面临链码泄露的风险，您应该从强化的父代而不是普通的父代派生。最佳做法是让主密钥的 1 级子级始终通过强化派生来派生，以防止主密钥泄露。


## 正常和硬化推导的索引号

**显然希望能够从给定的父密钥中导出一个以上的子密钥。为了管理这一点，使用了一个索引号。**每个索引号，当使用特殊的子派生函数与父密钥组合时，给出不同的子密钥。BIP-32父子推导函数中使用的索引号是一个32位整数。为了轻松区分通过正常（未加固）派生函数派生的密钥与通过加固派生函数派生的密钥，该索引号分为两个范围。0 到 2^31–1（0x0 到 0x7FFFFFFF）之间的索引号仅用于正常推导。2^31 和 2^32–1 之间的索引号（0x80000000 到 0xFFFFFFFF）仅用于强化派生。因此，如果索引号小于 2^31，则孩子是正常的，而如果索引号等于或大于 2^31，则孩子被加固了。

为了使索引编号更易于阅读和显示，强化儿童的索引编号从零开始显示，但带有一个撇号。因此，第一个普通子键显示为 0，而第一个强化子键（索引 0x80000000）显示为 0'。然后，第二个加固密钥的索引为 0x80000001，并显示为 1'，依此类推。当您看到 HD 钱包索引 i' 时，表示 2^31 + i。

### HD钱包钥匙标识符(路径)

HD钱包中的密钥使用"路径"命名约定来表示，树的每个级别都由斜杠(/)字符分割(请参阅HD钱包路径示例)。从主公钥派生的公钥以M开头，因此，主私钥的第一个子私钥为m/0.第一个子公钥是M/0.第一个孩子的第二个孙子是m/0/1，以此类推。

密钥的“祖先”是从右到左读取的，直到您到达派生密钥的主密钥。例如，标识符 m/x/y/z 描述的密钥是密钥 m/x/y 的第 z 个子密钥，它是密钥 m/x 的第 y 个子密钥。

表5.HD钱包路径示例

|HD路径|解释|
|--|--|
|m/0|主私钥的第一个子私钥|
|m/0/0|第一个孩子的第一个第一个孙密钥|
|m/0'/0|第一个硬化孩子的第一个正常孙子|
|m/1/0|老二的第一个孙子密钥|
|M/23/17/0/0|第24个孩子的第18个孙子的第一个曾孙的第一个玄孙公钥|

### 浏览HD钱包树结构

HD钱包树结构非常灵活。另一方面，它也允许无限的复杂性:每个父扩展密钥可以有40亿个孩子:20亿个正常孩子和20亿个强化孩子。这些孩子中的每一个都可以再生育40亿个孩子，依此类推。树的深度是可以随心所欲的，世代数可能是无限的。凭借所有这些潜力，在这些非常大的树木中导航可能会变得非常困难。

两个BIP提供了一种通过为HD钱包树的结构创建标准来管理这种潜在的复杂性的方法。BIP43建议使用第一个硬化子索引作为表示树结构"目的"的特殊标识符。基于BIP-43,HD钱包应该只使用树的一个一级分值，索引号通过识别树的其余部分的结构和命名空间来定义钱包的用途。更具体地说，仅使用分值m/i'/...的HD钱包旨在表示特定目的，该目的由索引号i标识。

BIP-44扩展了该规范，提出了一种多货币多账户结构，通过将"目的"数字设置为44来标识。所有遵循BIP-44结构的HD钱包都通过它们只使用树的一个分支这一事实来识别:m/44/*


BIP-44 指定结构由五个预定义的树级别组成：

>  m / purpose' / coin_type' / account' / change / address_index


第一级,purpose'，总是设置为44.第二层coin_type指定加密货币硬币的类型，允许多币种HD钱包，其中每种货币在第二层下都有自己的子树。

在名为 SLIP0044 的标准文件中定义了多种货币；例如，以太坊是 m/44'/60'，Ethereum Classic 是 m/44'/61'，比特币是 m/44'/0'，所有货币的 Testnet 是 m/44'/1'。


树的第三层是账户，它允许用户将他们的钱包细分为单独的逻辑子账户，用于会计或组织目的。例如，一个 HD 钱包可能包含两个以太坊“账户”：m/44'/60'/0' 和 m/44'/60'/1'。每个帐户都是其子树的根。

因为 BIP-44 最初是为比特币创建的，所以它包含一个与以太坊世界无关的“怪癖”。在路径的第四层，零钱，HD 钱包有两个子树：一个用于创建接收地址，一个用于创建零钱地址。以太坊只使用“接收”路径，因为没有必要像比特币那样更改地址.请注意，虽然之前的级别使用强化推导，但此级别使用正常推导。这是为了允许树的帐户级别导出扩展公钥，以便在非安全环境中使用。可用地址由 HD 钱包派生为第四级的子级，使树的第五级成为 address_index。例如，主账户中以太坊支付的第三个接收地址为 M/44'/60'/0'/0/2。

表6. HD钱包结构示例

| HD path| 解释|
|--|--|
|M/44/60/0/0/2|主以太坊账户的第三个接收公钥|
|M/44/0/3/1/14|第4个比特币账户的第15个更改地址公钥|
|m/44/2/0/0/1|莱特币主账户中的第二个私钥，用于签署交易|

## 总结

钱包是任何面向用户的区块链应用程序的基础。它们允许用户管理密钥和地址的集合。正如我们将在 [交易章节] 中看到的那样，钱包还允许用户通过应用数字签名来证明他们对以太币的所有权并授权交易。






